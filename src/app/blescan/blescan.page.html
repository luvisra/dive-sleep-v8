<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start"><ion-back-button style="position: absolute;"></ion-back-button></ion-buttons>
    <ion-title *ngIf="deviceService.isDebugMode" (click)="forceOta()">{{ 'DEVICE.title2' | translate }}</ion-title>
    <ion-title *ngIf="!deviceService.isDebugMode">{{ 'DEVICE.title2' | translate }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="rcorners1" slot>
    <h2>{{ 'DEVICE.connectWifi' | translate }}</h2>
    <ion-label color="success" *ngIf="foundBleDev != null && foundBleDev != undefined && foundBleDevId !== null && deviceService.isAndroid">
      {{ foundBleDevId }} {{ 'DEVICE.scanned' | translate }}</ion-label>
    <ion-label color="success" *ngIf="foundBleDev != null && foundBleDev != undefined && foundBleDevId !== null && !deviceService.isAndroid">
      {{ 'DEVICE.sensorScanned' | translate }}</ion-label>
    <ion-button color="danger" *ngIf="foundBleDev == null || foundBleDev == undefined" (click)="rescanBle()">
      <ion-icon name="refresh" style="margin-right: 5px;"></ion-icon>{{ 'DEVICE.retry' | translate }}
    </ion-button>
    <h6>{{ 'DEVICE.restriction' | translate }}</h6>
    <form #wifiForm="ngForm" novalidate style="margin-top: 5px;">
      <ion-list>
        <ion-item>
          <ion-label position="stacked" color="dark">{{ 'DEVICE.wifiName' | translate }}</ion-label>

          <ion-input placeholder="WiFi Name (SSID)" [(ngModel)]="currentSSID" name="ssid" type="text" #ssid="ngModel"
            spellcheck="false" autocapitalize="off" color="dark" required>
          </ion-input>

          <ion-button *ngIf="deviceService.isAndroid" color="dark" item-end slot="end" style="margin-top:2.0em; margin-right:0;" fill="clear"
            (click)="getNetworks()">
            <ion-icon name="refresh" style="font-size: 1.5rem;"></ion-icon>
          </ion-button>
          <ion-button *ngIf="!deviceService.isAndroid" color="dark" item-end slot="end" style="margin-top:2.0em; margin-right:0;" fill="clear"
            (click)="openWifiSettingsIos()">
            <ion-icon name="wifi" style="font-size: 1.5rem;"></ion-icon>
          </ion-button>
        </ion-item>

        <ion-item>
          <ion-label placeholder="PASSWORD" position="stacked" color="dark">{{ 'LOGIN.password' | translate }}</ion-label>
          <ion-input [(ngModel)]="passwordText" name="password" #password="ngModel" (keyup.enter)="onConnectToWiFi(wifiForm)"></ion-input>
        </ion-item>
        <ion-text color="danger">
          <p [hidden]="password.valid || submitted == false" class="ion-padding-start">
            Password is required
          </p>
        </ion-text>
      </ion-list>
    </form>

    <div *ngIf="deviceService.isAndroid" class="wifi-list-container">
      <div class="wifi-list-scroll">
        <ion-list>
          <ion-item *ngFor="let r of results" (click)="ssidSelected(r.SSID)" button detail="false">
            <ion-label>
              <h3>{{ r.SSID }}</h3>
              <p *ngIf="r.level">신호세기: {{ r.level }} dBm</p>
            </ion-label>
            <ion-icon name="wifi" slot="end" [class.wifi-strong]="r.level && r.level > -60"
                      [class.wifi-medium]="r.level && r.level <= -60 && r.level > -70"
                      [class.wifi-weak]="r.level && r.level <= -70"></ion-icon>
          </ion-item>
          <ion-item *ngIf="results.length === 0">
            <ion-label class="ion-text-center">
              <p>{{ 'DEVICE.noWifiFound' | translate }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </div>
    </div>

    <div class="button-container">
      <ion-button (click)="onConnectToWiFi(wifiForm)" type="submit" color="warning"
        shape="round" expand="block">
        {{ 'DEVICE.connectWifi' | translate }}
      </ion-button>
    </div>
  </div>
</ion-content>
